/* Editor styles with CSS variable support for theming */
@import '../../shared/typography.css';

:root {
  --editor-bg: #ffffff;
  --editor-text: #000000;
  --editor-selection: rgba(0, 122, 255, 0.3);
  --accent-color: #007aff;
}

html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  background: var(--editor-bg);
  color: var(--editor-text);
  font-family: var(--font-sans);
  font-size: var(--font-size-body);
  font-weight: var(--weight-body, 400);
}

#editor {
  padding: 24px 48px;
  min-height: 100%;
  outline: none;
}

.milkdown { background: var(--editor-bg); color: var(--editor-text); }
.milkdown .editor { outline: none; }
.ProseMirror { outline: none; }
.ProseMirror ::selection { background: var(--editor-selection); }

/* Focus mode dimming */
.ff-dimmed { opacity: 0.3; transition: opacity 0.2s ease; }

/* Typography */
.milkdown h1, .milkdown h2, .milkdown h3, .milkdown h4, .milkdown h5, .milkdown h6 {
  color: var(--editor-text);
  margin-top: 1.5em;
  margin-bottom: 0.5em;
  line-height: var(--line-height-heading);
  font-weight: var(--weight-heading, 600);
  text-wrap: balance;
}

.milkdown h1 {
  font-size: var(--font-size-h1);
  letter-spacing: var(--tracking-tight);
}

.milkdown h2 {
  font-size: var(--font-size-h2);
  letter-spacing: var(--tracking-tight);
}

.milkdown h3 { font-size: var(--font-size-h3); }
.milkdown h4 { font-size: var(--font-size-h4); }
.milkdown h5 { font-size: var(--font-size-h5); }
.milkdown h6 { font-size: var(--font-size-h6); }

.milkdown p {
  margin: 0.75em 0;
  line-height: var(--line-height-body);
  text-wrap: pretty;
}

/* Code */
.milkdown code {
  background: rgba(128, 128, 128, 0.1);
  padding: 0.2em 0.4em;
  border-radius: 3px;
  font-family: var(--font-mono);
  font-size: 0.9em;
}

.milkdown pre {
  background: rgba(128, 128, 128, 0.1);
  padding: 1em;
  border-radius: 6px;
  overflow-x: auto;
  font-family: var(--font-mono);
}

/* Links and lists */
.milkdown a { color: var(--accent-color); text-decoration: none; }
.milkdown a:hover { text-decoration: underline; }
.milkdown ul, .milkdown ol { padding-left: 1.5em; }
.milkdown li { margin: 0.25em 0; }
.milkdown blockquote { border-left: 4px solid var(--accent-color); margin: 1em 0; padding-left: 1em; opacity: 0.9; }

/* Section break - compact visual separator */
.section-break {
  display: block;
  color: var(--editor-muted, #999);
  font-size: 1.5em;
  line-height: 1;  /* Keep symbol compact - no extra vertical space */
  text-align: left;
  user-select: all;
  cursor: default;
  margin: 8px 0;  /* Fixed small margin for minimal visual footprint */
}

/* Hide slash menu when SlashProvider sets data-show="false" */
.slash-menu[data-show="false"] {
  display: none !important;
}

/* === Annotation Styles === */

/* Base annotation container (Hybrid pattern) */
.ff-annotation {
  display: inline;
  font-size: 0.9em;
  padding: 0 2px;
  border-radius: 2px;
  vertical-align: baseline;
  background: rgba(128, 128, 128, 0.05);
}

/* Non-editable marker */
.ff-annotation-marker {
  user-select: none;
  margin-right: 2px;
}

/* Editable text area */
.ff-annotation-text {
  outline: none;
  min-width: 1em;
  display: inline;
}

/* Empty annotation placeholder */
.ff-annotation-text:empty::before {
  content: 'type here...';
  color: var(--editor-muted, #999);
  font-style: italic;
}

/* Task annotation */
.ff-annotation-task {
  color: var(--annotation-task, #f59e0b);
}

.ff-annotation-task.ff-annotation-completed {
  color: var(--annotation-task-completed, #10b981);
}

/* Comment annotation */
.ff-annotation-comment {
  color: var(--annotation-comment, #3b82f6);
}

/* Reference annotation */
.ff-annotation-reference {
  color: var(--annotation-reference, #8b5cf6);
}

/* Hidden mode (panel-only) */
.ff-annotation-hidden {
  display: none !important;
}

/* Collapsed mode - marker only, hide text */
.ff-annotation-collapsed {
  opacity: 0.6;
  position: relative;
  background: transparent;
  padding: 0;
}

/* Hide the text in collapsed mode */
.ff-annotation-collapsed .ff-annotation-text {
  display: none;
}

/* Remove margin from marker when collapsed */
.ff-annotation-collapsed .ff-annotation-marker {
  margin-right: 0;
}

/* Tooltip for collapsed annotations - shows full text on hover */
.ff-annotation-collapsed::after {
  content: attr(data-text);
  position: absolute;
  left: 50%;
  bottom: 100%;
  transform: translateX(-50%);
  padding: 6px 10px;
  background: var(--tooltip-bg, #1f2937);
  color: var(--tooltip-text, #f3f4f6);
  font-size: 12px;
  line-height: 1.4;
  border-radius: 6px;
  white-space: pre-wrap;
  max-width: 280px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.25);
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.15s ease, visibility 0.15s ease;
  z-index: 1000;
  pointer-events: none;
  margin-bottom: 4px;
}

/* Arrow for tooltip */
.ff-annotation-collapsed::before {
  content: '';
  position: absolute;
  left: 50%;
  bottom: 100%;
  transform: translateX(-50%);
  border: 5px solid transparent;
  border-top-color: var(--tooltip-bg, #1f2937);
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.15s ease, visibility 0.15s ease;
  z-index: 1001;
  margin-bottom: -1px;
}

/* Show tooltip on hover */
.ff-annotation-collapsed:hover::after,
.ff-annotation-collapsed:hover::before {
  opacity: 1;
  visibility: visible;
}

/* Hover states */
.ff-annotation:hover {
  opacity: 1;
  background: rgba(128, 128, 128, 0.1);
}

/* === Highlight Styles === */

/* Highlight mark for ==text== */
.ff-highlight,
mark.ff-highlight {
  background-color: var(--highlight-bg, rgba(255, 235, 59, 0.4));
  color: inherit;
  padding: 0 2px;
  border-radius: 2px;
}

/* Dark mode adjustment */
@media (prefers-color-scheme: dark) {
  .ff-highlight,
  mark.ff-highlight {
    background-color: var(--highlight-bg, rgba(255, 235, 59, 0.25));
  }
}

/* === Citation Styles === */

/* Base citation container */
.ff-citation {
  display: inline;
  font-size: 0.95em;
  padding: 1px 4px;
  border-radius: 3px;
  cursor: pointer;
  transition: background 0.15s ease;
}

/* Resolved citation (valid citekey) */
.ff-citation-resolved {
  color: var(--citation-resolved, #059669);
  background: rgba(5, 150, 105, 0.08);
}

.ff-citation-resolved:hover {
  background: rgba(5, 150, 105, 0.15);
}

/* Unresolved citation (unknown citekey) */
.ff-citation-unresolved {
  color: var(--citation-unresolved, #dc2626);
  background: rgba(220, 38, 38, 0.08);
}

.ff-citation-unresolved:hover {
  background: rgba(220, 38, 38, 0.15);
}

/* Citation in edit mode */
.ff-citation-editing {
  font-family: 'SF Mono', Menlo, Monaco, monospace;
  font-size: 0.9em;
  background: rgba(128, 128, 128, 0.1);
  color: var(--editor-text);
  outline: 2px solid var(--accent-color, #007aff);
  outline-offset: 1px;
}

/* Citation search popup results */
.ff-citation-search-item:hover {
  background: var(--editor-selection, rgba(0, 122, 255, 0.15)) !important;
}

.ff-citation-search-item.selected {
  background: var(--editor-selection, #e8f0fe);
}
